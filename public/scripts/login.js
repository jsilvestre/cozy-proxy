// Generated by CoffeeScript 1.4.0
(function() {

  $(function() {
    var button, errorAlert, forgotPassword, loader, passwordInput, submitPassword, successAlert;
    loader = $('.loading');
    button = $('#submit-btn');
    passwordInput = $('#password-input');
    errorAlert = $('.alert-error');
    successAlert = $('.alert-success');
    forgotPassword = $('#forgot-password');
    submitPassword = function() {
      button.spin('small');
      loader.spin('small');
      return client.post("/login", {
        password: passwordInput.val()
      }, {
        success: function() {
          var msg;
          errorAlert.hide();
          forgotPassword.hide();
          msg = "Sign in succeeded, let's go to the Cozy Home...";
          successAlert.html(msg);
          successAlert.fadeIn();
          loader.spin();
          button.spin();
          button.html('sign in');
          return wait(1000, function() {
            return $('#content').fadeOut(function() {
              return wait(500, function() {
                var newpath;
                newpath = window.location.pathname.substring(6);
                return window.location.pathname = newpath;
              });
            });
          });
        },
        error: function(err) {
          var msg;
          msg = JSON.parse(err.responseText).error;
          successAlert.fadeOut();
          errorAlert.hide();
          errorAlert.html(msg);
          errorAlert.fadeIn();
          loader.spin();
          button.spin();
          button.html("sign in");
          return forgotPassword.fadeIn();
        }
      });
    };
    passwordInput.keyup(function(event) {
      if (event.which === 13) {
        return submitPassword();
      }
    });
    button.click(submitPassword);
    forgotPassword.click(function(event) {
      return client.post("/login/forgot", {}, {
        success: function() {
          errorAlert.fadeOut();
          successAlert.fadeIn();
          return successAlert.html("An email has been sent to your mailbox, " + "follow its instructions to get a new password");
        },
        error: function(err) {
          var msg;
          successAlert.fadeOut();
          errorAlert.hide();
          msg = JSON.parse(err.responseText).msg;
          errorAlert.html(msg);
          return errorAlert.fadeIn();
        }
      });
    });
    return passwordInput.focus();
  });

}).call(this);
